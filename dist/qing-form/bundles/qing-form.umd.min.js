!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("ng-zorro-antd"),require("@angular/forms"),require("formula-calculator")):"function"==typeof define&&define.amd?define("qing-form",["exports","@angular/common","@angular/core","ng-zorro-antd","@angular/forms","formula-calculator"],t):t((e=e||self)["qing-form"]={},e.ng.common,e.ng.core,e.ngZorroAntd,e.ng.forms,e.formulaCalculator)}(this,(function(e,t,n,o,r,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function l(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}var f=function(){function e(e){this.fieldMap=e}return e.prototype.fieldMapFn=function(e){return this.fieldMap[e]},e}();var p=function(){function e(){}return Object.defineProperty(e.prototype,"formControl",{get:function(){return this.field.formControl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholder",{get:function(){return this.field.templateOptions&&this.field.templateOptions.placeholder||""},enumerable:!0,configurable:!0}),e.propDecorators={field:[{type:n.Input}]},e}();var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.ngOnInit=function(){},t.prototype.log=function(e){console.log(e)},t.decorators=[{type:n.Component,args:[{selector:"qf-input",template:'<input\r\n  nz-input\r\n  [placeholder]="placeholder"\r\n  [formControl]="formControl">'}]}],t}(p),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkOptionsOne=[{label:"Apple",value:"Apple",checked:!0},{label:"Pear",value:"Pear"},{label:"Orange",value:"Orange"}],t}return l(t,e),t.prototype.ngOnInit=function(){},t.decorators=[{type:n.Component,args:[{selector:"qf-checkbox",template:'<nz-checkbox-group [formControl]="formControl"></nz-checkbox-group>'}]}],t}(p);var g={input:u,checkbox:s},d=function(){function e(e){this.cfr=e}return Object.defineProperty(e.prototype,"label",{get:function(){return this.field.templateOptions?this.field.templateOptions.label:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this.fieldTypesMap=new f(g),this.fieldTypesMap.fieldMapFn(this.field.type)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){var t=this.cfr.resolveComponentFactory(this.componentType);this.componentContainerRef.clear(),this.componentRef=this.componentContainerRef.createComponent(t);var n=this.componentRef.instance;Object.assign(n,{field:this.field}),this.componentRef.changeDetectorRef.detectChanges()},e.prototype.ngOnInit=function(){},e.prototype.ngOnDestroy=function(){this.componentRef.destroy()},e.decorators=[{type:n.Component,args:[{selector:"qf-field",template:'<div class="qf-field-item">\n  <div *ngIf="label" class="qf-field-label">\n    <label>{{ label }}</label>\n  </div>\n  <ng-template #componentContainer></ng-template>\n</div>',styles:[".qf-field-item{margin-bottom:16px}.qf-field-label{font-size:14px;font-weight:500;padding:0 0 5px}"]}]}],e.ctorParameters=function(){return[{type:n.ComponentFactoryResolver}]},e.propDecorators={field:[{type:n.Input}],componentContainerRef:[{type:n.ViewChild,args:["componentContainer",{read:n.ViewContainerRef,static:!0}]}]},e}();var m=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[o.NgZorroAntdModule,t.CommonModule,r.ReactiveFormsModule,r.FormsModule],declarations:[u,s],entryComponents:[u,s],exports:[u,s]}]}],e}(),h=function(){function e(){}return e.prototype.buildForm=function(e,t){var n=this;t.forEach((function(t){n.registerControl(e,t)}))},e.prototype.registerControl=function(e,t){var n=t.key,o=t.templateOptions,i=o.defaultValue,a=o.options,l=new r.FormControl(i||a);t.formControl=l,e.registerControl(n,l)},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),y=/#.+?\$/g;var b=function(){function e(e){this.formBuilder=e,this.controlChangeSubs=[],this.triggerMap=new Map}return e.prototype.ngOnChanges=function(e){this.controlChangeSubs.forEach((function(e){return e.unsubscribe()})),this.formBuilder.buildForm(this.form,this.fields),this.setTriggerMap(),this.trackControlChanges()},e.prototype.ngOnInit=function(){},e.prototype.ngOnDestroy=function(){this.controlChangeSubs.forEach((function(e){return e.unsubscribe()})),this.controlChangeSubs=[],this.triggerMap.clear()},e.prototype.setTriggerMap=function(){var e=this;this.fields.forEach((function(t){var n=t.templateOptions.formula;n&&function(e,t){var n=[];return e.match(y)?(e.match(y).forEach((function(e){var t=c(e.substring(1,e.indexOf("$")).split("."),1)[0];n.push(t)})),n):[]}(n,e.fields).forEach((function(n){e.triggerMap.has(n)||e.triggerMap.set(n,[]),e.triggerMap.get(n).push(t)}))}))},e.prototype.trackControlChanges=function(){var e=this;this.fields.forEach((function(t){var n=t.formControl,o=t.key,r=n.valueChanges;e.controlChangeSubs.push(r.subscribe((function(t){e.triggerMap.has(o)&&e.handleTrigger(e.triggerMap.get(o))})))}))},e.prototype.handleTrigger=function(e){var t=this;e.forEach((function(e){var n=e.key,o=e.templateOptions,r=o.valueType,a=o.formula;if("formula"===r){var l=function(e,t){var n=e.replace(y,(function(e){var n=c(e.substring(1,e.indexOf("$")).split("."),1)[0];return t.get(n).value}));try{return i.calculate(n)}catch(e){console.error(e)}}(a,t.form);t.form.get(n).setValue(l)}}))},e.decorators=[{type:n.Component,args:[{selector:"qf-form",template:'<ng-container *ngFor="let field of fields">\r\n  <qf-field [field]="field"></qf-field>\r\n</ng-container>'}]}],e.ctorParameters=function(){return[{type:h}]},e.propDecorators={fields:[{type:n.Input}],form:[{type:n.Input}]},e}();var v=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule,m],declarations:[d,b],exports:[d,b]}]}],e}();e.QingFormModule=v,e.ɵa=m,e.ɵb=u,e.ɵc=p,e.ɵd=s,e.ɵe=d,e.ɵf=b,e.ɵg=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=qing-form.umd.min.js.map